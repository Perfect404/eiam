/*
 * eiam-portal - Employee Identity and Access Management Program
 * Copyright Â© 2020-2023 TopIAM (support@topiam.cn)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
"use strict";(self.webpackChunktopiam_portal=self.webpackChunktopiam_portal||[]).push([[956],{35678:function(he,R,s){s.r(R),s.d(R,{default:function(){return xe}});var G=s(84019),j=s.n(G),M=s(32061),F=s.n(M),W=s(7863),J=s.n(W),K=s(5903),Q=s(8582),V=s(53448),X=s(18189),U=s(79357),b=s(15457),w=s(21451),y=s(25374),P=s(81381),k=s(93973),L=s(91902),q=s(66939),B=s.n(q),E=s(79685),_=s(76815),A=s(57346),ee=s(96569),T;(function(d){d.admin="admin",d.user="user"})(T||(T={}));var C;(function(d){d.success="success",d.fail="fail"})(C||(C={}));var ne=s(39620),u=s.n(ne),$=s(84904),H=s(47918),ae=H.ZP.ConfigContext;function te(d){var v=".".concat(d),i=(0,E.useContext)(ae),f=i.getPrefixCls,x=".".concat(f()),h=(0,$.l)(function(){var l,p,c;return u()({},"".concat(v),(c={display:"flex",paddingLeft:"10px"},u()(c,"&-line-user",{flex:1,marginRight:"24px"}),u()(c,"&-line-event",{flex:1,marginRight:"24px"}),u()(c,"&-line-geo",{flex:1,marginRight:"24px"}),u()(c,"&-label",(l={display:"block",minWidth:"80px",color:"#878a95",fontSize:"14px"},u()(l,"".concat(x,"-collapse-header"),{paddingTop:"0 !important",paddingBottom:"0 !important"}),u()(l,"".concat(x,"-collapse-header-text"),{color:"#878a95"}),l)),u()(c,"&-panel",(p={fontSize:"14px"},u()(p,"".concat(x,"-collapse-header"),{paddingTop:"0 !important",paddingBottom:"0 !important"}),u()(p,"".concat(x,"-collapse-header-text"),{color:"#878a95"}),u()(p,"".concat(x,"-collapse-content>").concat(x,"-collapse-content-box"),{paddingTop:"6px  !important",paddingBottom:"6px  !important"}),u()(p,"&-content",u()({padding:"0px 24px  !important"},"p",{marginBottom:"6px   !important"})),p)),u()(c,"&-content",{display:"block",flexWrap:"wrap",overflowX:"auto",color:"#293350",fontSize:"14px"}),u()(c,"&-each-line",{display:"flex",marginBottom:"14px"}),u()(c,"&-target",{flex:1}),c))});return{className:h}}var se=s(68591),n=s.n(se),e=s(63342),a="audit-expanded-card",ce=_.Z.Text,D=A.Z.Panel,le=function(v){var i,f,x,h,l,p,c,t=v.record,r=te(a),m=r.className,N=function(g){return!g||g==="null"||g==="-"||g==="undefined"?"-":g};return(0,e.jsx)("div",{className:m,children:(0,e.jsxs)("div",{className:n()("".concat(a)),children:[(0,e.jsxs)("div",{className:n()("".concat(a,"-line-user")),children:[(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u64CD\u4F5C\u8005 ID"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:(0,e.jsx)(ee.Z,{style:{marginBottom:0},className:n()("".concat(a,"-content")),copyable:!0,children:N(t.userId)})})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u64CD\u4F5C\u8005\u540D\u79F0"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:N(t.username)})]})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-line-geo")),children:[(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u8BBE\u5907\u7C7B\u578B"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:t.userAgent&&((i=t.userAgent)===null||i===void 0?void 0:i.deviceType)||"-"})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u64CD\u4F5C\u7CFB\u7EDF"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:t.userAgent&&((f=t.userAgent)===null||f===void 0?void 0:f.platform)||"-"})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u5BA2\u6237\u7AEFIP"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:((x=t.geoLocation)===null||x===void 0?void 0:x.ip)||"-"})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u6D4F\u89C8\u5668"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:t.userAgent&&((h=t.userAgent)===null||h===void 0?void 0:h.browser)||"-"})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u56FD\u5BB6"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:t.geoLocation&&((l=t.geoLocation)===null||l===void 0?void 0:l.countryName)||"-"})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u7701\u4EFD"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:t.geoLocation&&((p=t.geoLocation)===null||p===void 0?void 0:p.provinceName)||"-"})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u57CE\u5E02"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:t.geoLocation&&((c=t.geoLocation)===null||c===void 0?void 0:c.cityName)||"-"})]})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-line-event")),children:[(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u4E8B\u4EF6\u65F6\u95F4"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:(0,e.jsx)(ce,{style:{maxWidth:"100%"},ellipsis:!0,children:B()(t.eventTime).format("YYYY.MM.DD HH:mm:ss")})})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u4E8B\u4EF6\u7C7B\u578B"}),(0,e.jsx)("span",{className:n()("".concat(a,"-content")),children:t.eventType})]}),(0,e.jsxs)("div",{className:n()("".concat(a,"-each-line")),children:[(0,e.jsx)("span",{className:n()("".concat(a,"-label")),children:"\u4E8B\u4EF6\u72B6\u6001"}),(0,e.jsxs)("span",{className:n()("".concat(a,"-content")),children:[t.eventStatus===C.success&&(0,e.jsx)("span",{style:{color:"#87d068"},children:"\u6210\u529F"}),t.eventStatus===C.fail&&(0,e.jsx)("span",{style:{color:"#e54545"},children:"\u5931\u8D25"})]})]})]}),t.targets&&(0,e.jsx)("div",{className:n()("".concat(a,"-line-target")),children:(0,e.jsx)("div",{className:n()("".concat(a,"-each-line")),children:(0,e.jsx)(A.Z,{ghost:!0,children:(0,e.jsx)(D,{header:"\u64CD\u4F5C\u5BF9\u8C61",className:n()("".concat(a,"-panel")),children:t.targets.map(function(o){return(0,e.jsx)(A.Z,{ghost:!0,children:o!=null&&o.name?(0,e.jsx)(D,{header:o.name,className:n()("".concat(a,"-panel")),children:(0,e.jsxs)("div",{className:n()("".concat(a,"-panel-content")),children:[(0,e.jsxs)("p",{children:["\u5BF9\u8C61 ID\uFF1A",o.id]}),(0,e.jsxs)("p",{children:["\u5BF9\u8C61\u7C7B\u578B\uFF1A",o.typeName]})]})},o.type):(0,e.jsx)(D,{header:o.typeName,className:n()("".concat(a,"-panel")),children:(0,e.jsx)("div",{className:n()("".concat(a,"-panel-content")),children:(0,e.jsxs)("p",{children:["\u5BF9\u8C61\u7C7B\u578B\uFF1A",o.typeName]})})},o.type)},o.type)})},"1")})})})]})})},re=s(76091),S=s.n(re),Y=s(81996),O=s(84530);function oe(d,v,i){return Z.apply(this,arguments)}function Z(){return Z=F()(j()().mark(function d(v,i,f){return j()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,O.request)("/api/audit/list",{params:S()(S()(S()({},v),{},{userType:"user",startEventTime:v.eventTime&&v.eventTime[0],endEventTime:v.eventTime&&v.eventTime[1]},(0,Y.YE)(i)),(0,Y.oH)(f))}).then(function(l){var p,c,t,r,m={data:l!=null&&(p=l.result)!==null&&p!==void 0&&p.list?l==null||(c=l.result)===null||c===void 0?void 0:c.list:[],success:l==null?void 0:l.success,total:l!=null&&(t=l.result)!==null&&t!==void 0&&t.pagination?l==null||(r=l.result)===null||r===void 0?void 0:r.pagination.total:0};return Promise.resolve(m)}));case 1:case"end":return h.stop()}},d)})),Z.apply(this,arguments)}function ue(){return I.apply(this,arguments)}function I(){return I=F()(j()().mark(function d(){return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,O.request)("/api/audit/types/user"));case 1:case"end":return i.stop()}},d)})),I.apply(this,arguments)}var ie=H.ZP.ConfigContext;function de(d){var v=".".concat(d),i=(0,E.useContext)(ie),f=i.getPrefixCls,x=".".concat(f()),h=(0,$.l)(function(){return u()({},"".concat(v),u()({},"".concat(x,"-table-expanded-row-fixed"),{width:"auto !important"}))});return{className:h}}var pe=w.Z.RangePicker,me=y.Z.OptGroup,ve=y.Z.Option,z="audit-user",xe=function(){var d=(0,E.useRef)(),v=(0,U.Z)(),i=J()(v,2),f=i[0],x=i[1],h=de(z),l=h.className;(0,b.Z)(F()(j()().mark(function c(){var t,r,m;return j()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ue();case 2:t=o.sent,r=t.result,m=t.success,m&&x(r);case 6:case"end":return o.stop()}},c)})),[]);var p=[{title:"\u4E8B\u4EF6\u7C7B\u578B",dataIndex:"eventType",fixed:"left",renderFormItem:function(){return(0,e.jsx)(y.Z,{placeholder:"\u8BF7\u9009\u62E9\u4E8B\u4EF6\u7C7B\u578B",showSearch:!0,allowClear:!0,mode:"multiple",maxTagCount:"responsive",children:f&&f.map(function(t){return(0,e.jsx)(me,{label:t.name,children:t.types&&t.types.map(function(r){return(0,e.jsx)(ve,{value:r.code,children:r.name},r.code)})},t.code)})},"select")}},{title:"\u64CD\u4F5C\u8005",ellipsis:!0,dataIndex:"username",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}},{title:"\u5BA2\u6237\u7AEFIP",dataIndex:"geoLocation",ellipsis:!0,valueType:"text",hideInSearch:!0,render:function(t,r){var m=r.geoLocation;return m?(0,e.jsx)(P.Z,{status:"success",text:m.ip}):(0,e.jsx)(P.Z,{status:"error",text:"\u672A\u77E5"})}},{title:"\u64CD\u4F5C\u7CFB\u7EDF",ellipsis:!0,dataIndex:"platform",render:function(t,r){var m=r.userAgent;return m.platform}},{title:"\u6D4F\u89C8\u5668",ellipsis:!0,dataIndex:"browser",render:function(t,r){var m=r.userAgent;return m.browser}},{title:"\u4E8B\u4EF6\u65F6\u95F4",sorter:!0,defaultSortOrder:"descend",ellipsis:!0,align:"center",dataIndex:"eventTime",valueType:"dateTime",renderFormItem:function(){return(0,e.jsx)(pe,{showTime:{hideDisabledOptions:!0,defaultValue:[B()("00:00:00","HH:mm:ss"),B()("11:59:59","HH:mm:ss")]},placeholder:["\u5F00\u59CB\u65F6\u95F4","\u7ED3\u675F\u65F6\u95F4"],format:"YYYY-MM-DD HH:mm:ss"})}},{title:"\u4E8B\u4EF6\u72B6\u6001",dataIndex:"eventStatus",hideInSearch:!0,align:"center",fixed:"right",width:150,render:function(t){return(0,e.jsxs)(k.Z,{children:[t===C.success&&(0,e.jsx)(L.Z,{color:"#87d068",children:"\u6210\u529F"}),t===C.fail&&(0,e.jsx)(L.Z,{color:"#e54545",children:"\u5931\u8D25"})]})}}];return(0,e.jsx)(V._z,{className:l,content:"\u5BA1\u8BA1\u65E5\u5FD7\u8BB0\u5F55\u4E86\u6240\u6709\u5E73\u53F0\u7528\u6237\u8FDB\u884C\u7684\u5173\u952E\u64CD\u4F5C\uFF0C\u65E0\u8BBA\u662F\u7BA1\u7406\u5458\u8FDB\u884C\u7684\u6279\u91CF\u64CD\u4F5C\u3001\u8FD8\u662F\u7528\u6237\u4FA7\u8FDB\u884C\u7684\u591A\u56E0\u7D20\u8BA4\u8BC1\uFF0C\u90FD\u53EF\u4EE5\u5728\u8FD9\u91CC\u627E\u5230\u5BF9\u5E94\u7684\u8BB0\u5F55\uFF0C\u4EE5\u5BF9\u67D0\u6B21\u6539\u53D8\u63D0\u4F9B\u5145\u5206\u7684\u6EAF\u6E90\u6570\u636E\u3002",children:(0,e.jsx)(X.Z,{columns:p,scroll:{x:1200},pagination:{showQuickJumper:!0,defaultPageSize:10},search:{},expandable:{expandRowByClick:!0,expandedRowClassName:function(){return n()("".concat(z))},expandedRowRender:function(t,r){return(0,e.jsx)(le,{record:t,index:r})},expandIcon:function(t){var r=t.expanded,m=t.onExpand,N=t.record;return r?(0,e.jsx)(K.Z,{onClick:function(g){return m(N,g)}}):(0,e.jsx)(Q.Z,{onClick:function(g){return m(N,g)}})}},actionRef:d,params:{userType:T.user},request:oe,rowKey:"id",dateFormatter:"string"})})}}}]);
