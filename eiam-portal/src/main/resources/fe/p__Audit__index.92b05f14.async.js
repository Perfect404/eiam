/*
 * eiam-portal - Employee Identity and Access Management Program
 * Copyright Â© 2020-2023 TopIAM (support@topiam.cn)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
"use strict";(self.webpackChunktopiam_portal=self.webpackChunktopiam_portal||[]).push([[956],{56700:function(me,S,t){t.r(S),t.d(S,{default:function(){return ve}});var O=t(97983),j=t.n(O),Y=t(40794),F=t.n(Y),z=t(12741),G=t.n(z),M=t(39398),J=t(14313),K=t(19847),Q=t(65767),V=t(92652),W=t(2093),U=t(98033),y=t(34041),I=t(76521),X=t(26713),R=t(51904),b=t(27484),E=t.n(b),Z=t(67294),w=t(17057),k=t(95462),q=t(12812),x=t.n(q),L=t(38755);function _(o){var v=".".concat(o),u=(0,L.l)(function(){var l;return x()({},"".concat(v),(l={display:"flex","padding-left":"10px"},x()(l,"&-line-user",{flex:1,"margin-right":"24px"}),x()(l,"&-line-event",{flex:1,"margin-right":"24px"}),x()(l,"&-line-geo",{flex:1,"margin-right":"24px"}),x()(l,"&-label",{display:"block","min-width":"80px",color:"#878a95","font-size":"14px"}),x()(l,"&-content",{display:"block","flex-wrap":"wrap","overflow-x":"auto",color:"#293350","font-size":"14px"}),x()(l,"&-each-line",{display:"flex","margin-bottom":"14px"}),x()(l,"&-target",{flex:1}),l))});return{className:u}}var ee=t(94184),a=t.n(ee),B;(function(o){o.admin="admin",o.user="user"})(B||(B={}));var N;(function(o){o.success="success",o.fail="fail"})(N||(N={}));var e=t(85893),s="audit-expanded-card",ne=w.Z.Text,ae=function(v){var u,l,f,m,r,p,i,n=v.record,c=_(s),d=c.className,C=function(h){return!h||h==="null"||h==="-"||h==="undefined"?"-":h};return(0,e.jsx)("div",{className:d,children:(0,e.jsxs)("div",{className:a()("".concat(s)),children:[(0,e.jsxs)("div",{className:a()("".concat(s,"-line-user")),children:[(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u64CD\u4F5C\u8005 ID"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:(0,e.jsx)(k.Z,{style:{marginBottom:0},className:a()("".concat(s,"-content")),copyable:!0,children:C(n.userId)})})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u64CD\u4F5C\u8005\u540D\u79F0"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:C(n.username)})]})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-line-geo")),children:[(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u8BBE\u5907\u7C7B\u578B"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:n.userAgent&&((u=n.userAgent)===null||u===void 0?void 0:u.deviceType)||"-"})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u64CD\u4F5C\u7CFB\u7EDF"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:n.userAgent&&((l=n.userAgent)===null||l===void 0?void 0:l.platform)||"-"})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u5BA2\u6237\u7AEFIP"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:((f=n.geoLocation)===null||f===void 0?void 0:f.ip)||"-"})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u6D4F\u89C8\u5668"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:n.userAgent&&((m=n.userAgent)===null||m===void 0?void 0:m.browser)||"-"})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u56FD\u5BB6"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:n.geoLocation&&((r=n.geoLocation)===null||r===void 0?void 0:r.countryName)||"-"})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u7701\u4EFD"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:n.geoLocation&&((p=n.geoLocation)===null||p===void 0?void 0:p.provinceName)||"-"})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u57CE\u5E02"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:n.geoLocation&&((i=n.geoLocation)===null||i===void 0?void 0:i.cityName)||"-"})]})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-line-event")),children:[(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u4E8B\u4EF6\u65F6\u95F4"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:(0,e.jsx)(ne,{style:{maxWidth:"100%"},ellipsis:!0,children:E()(n.eventTime).format("YYYY.MM.DD HH:mm:ss")})})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u4E8B\u4EF6\u7C7B\u578B"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:n.eventType})]}),(0,e.jsxs)("div",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u4E8B\u4EF6\u72B6\u6001"}),(0,e.jsxs)("span",{className:a()("".concat(s,"-content")),children:[n.eventStatus===N.success&&(0,e.jsx)("span",{style:{color:"#87d068"},children:"\u6210\u529F"}),n.eventStatus===N.fail&&(0,e.jsx)("span",{style:{color:"#e54545"},children:"\u5931\u8D25"})]})]})]}),n.targets&&(0,e.jsx)("div",{className:a()("".concat(s,"-line-target")),children:(0,e.jsxs)("span",{className:a()("".concat(s,"-each-line")),children:[(0,e.jsx)("span",{className:a()("".concat(s,"-label")),children:"\u64CD\u4F5C\u5BF9\u8C61"}),(0,e.jsx)("span",{className:a()("".concat(s,"-content")),children:(0,e.jsx)("pre",{children:JSON.stringify(n.targets,null,3)},n.id)})]})})]})})},se=t(11281),A=t.n(se),$=t(40367),P=t(98971);function te(o,v,u){return D.apply(this,arguments)}function D(){return D=F()(j()().mark(function o(v,u,l){return j()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,P.request)("/api/audit/list",{params:A()(A()(A()({},v),{},{userType:"user",startEventTime:v.eventTime&&v.eventTime[0],endEventTime:v.eventTime&&v.eventTime[1]},(0,$.YE)(u)),(0,$.oH)(l))}).then(function(r){var p,i,n,c,d={data:r!=null&&(p=r.result)!==null&&p!==void 0&&p.list?r==null||(i=r.result)===null||i===void 0?void 0:i.list:[],success:r==null?void 0:r.success,total:r!=null&&(n=r.result)!==null&&n!==void 0&&n.pagination?r==null||(c=r.result)===null||c===void 0?void 0:c.pagination.total:0};return Promise.resolve(d)}));case 1:case"end":return m.stop()}},o)})),D.apply(this,arguments)}function ce(){return T.apply(this,arguments)}function T(){return T=F()(j()().mark(function o(){return j()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,P.request)("/api/audit/types/user"));case 1:case"end":return u.stop()}},o)})),T.apply(this,arguments)}var re=t(46986),le=re.ZP.ConfigContext;function ue(o){var v=".".concat(o),u=(0,Z.useContext)(le),l=u.getPrefixCls,f=".".concat(l()),m=(0,L.l)(function(){return x()({},"".concat(v),x()({},"".concat(f,"-table-expanded-row-fixed"),{width:"auto !important"}))});return{className:m}}var ie=U.Z.RangePicker,oe=y.Z.OptGroup,de=y.Z.Option,H="audit-user",ve=function(){var o=(0,Z.useRef)(),v=(0,V.Z)(),u=G()(v,2),l=u[0],f=u[1],m=ue(H),r=m.className;(0,W.Z)(F()(j()().mark(function i(){var n,c,d;return j()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,ce();case 2:n=g.sent,c=n.result,d=n.success,d&&f(c);case 6:case"end":return g.stop()}},i)})),[]);var p=[{title:"\u4E8B\u4EF6\u7C7B\u578B",dataIndex:"eventType",fixed:"left",renderFormItem:function(){return(0,e.jsx)(y.Z,{placeholder:"\u8BF7\u9009\u62E9\u4E8B\u4EF6\u7C7B\u578B",showSearch:!0,allowClear:!0,mode:"multiple",maxTagCount:"responsive",children:l&&l.map(function(n){return(0,e.jsx)(oe,{label:n.name,children:n.types&&n.types.map(function(c){return(0,e.jsx)(de,{value:c.code,children:c.name},c.code)})},n.code)})},"select")}},{title:"\u64CD\u4F5C\u8005",ellipsis:!0,dataIndex:"username",fieldProps:{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}},{title:"\u5BA2\u6237\u7AEFIP",dataIndex:"geoLocation",ellipsis:!0,valueType:"text",hideInSearch:!0,render:function(n,c){var d=c.geoLocation;return d?(0,e.jsx)(I.Z,{status:"success",text:d.ip}):(0,e.jsx)(I.Z,{status:"error",text:"\u672A\u77E5"})}},{title:"\u64CD\u4F5C\u7CFB\u7EDF",ellipsis:!0,dataIndex:"platform",render:function(n,c){var d=c.userAgent;return d.platform}},{title:"\u6D4F\u89C8\u5668",ellipsis:!0,dataIndex:"browser",render:function(n,c){var d=c.userAgent;return d.browser}},{title:"\u4E8B\u4EF6\u65F6\u95F4",sorter:!0,defaultSortOrder:"descend",ellipsis:!0,align:"center",dataIndex:"eventTime",valueType:"dateTime",renderFormItem:function(){return(0,e.jsx)(ie,{showTime:{hideDisabledOptions:!0,defaultValue:[E()("00:00:00","HH:mm:ss"),E()("11:59:59","HH:mm:ss")]},placeholder:["\u5F00\u59CB\u65F6\u95F4","\u7ED3\u675F\u65F6\u95F4"],format:"YYYY-MM-DD HH:mm:ss"})}},{title:"\u4E8B\u4EF6\u72B6\u6001",dataIndex:"eventStatus",hideInSearch:!0,align:"center",fixed:"right",width:150,render:function(n){return(0,e.jsxs)(X.Z,{children:[n===N.success&&(0,e.jsx)(R.Z,{color:"#87d068",children:"\u6210\u529F"}),n===N.fail&&(0,e.jsx)(R.Z,{color:"#e54545",children:"\u5931\u8D25"})]})}}];return(0,e.jsx)(K._z,{className:r,content:"\u5BA1\u8BA1\u65E5\u5FD7\u8BB0\u5F55\u4E86\u6240\u6709\u5E73\u53F0\u7528\u6237\u8FDB\u884C\u7684\u5173\u952E\u64CD\u4F5C\uFF0C\u65E0\u8BBA\u662F\u7BA1\u7406\u5458\u8FDB\u884C\u7684\u6279\u91CF\u64CD\u4F5C\u3001\u8FD8\u662F\u7528\u6237\u4FA7\u8FDB\u884C\u7684\u591A\u56E0\u7D20\u8BA4\u8BC1\uFF0C\u90FD\u53EF\u4EE5\u5728\u8FD9\u91CC\u627E\u5230\u5BF9\u5E94\u7684\u8BB0\u5F55\uFF0C\u4EE5\u5BF9\u67D0\u6B21\u6539\u53D8\u63D0\u4F9B\u5145\u5206\u7684\u6EAF\u6E90\u6570\u636E\u3002",children:(0,e.jsx)(Q.Z,{columns:p,scroll:{x:1200},pagination:{showQuickJumper:!0,defaultPageSize:10},search:{},expandable:{expandRowByClick:!0,expandedRowClassName:function(){return a()("".concat(H))},expandedRowRender:function(n,c){return(0,e.jsx)(ae,{record:n,index:c})},expandIcon:function(n){var c=n.expanded,d=n.onExpand,C=n.record;return c?(0,e.jsx)(M.Z,{onClick:function(h){return d(C,h)}}):(0,e.jsx)(J.Z,{onClick:function(h){return d(C,h)}})}},actionRef:o,params:{userType:B.user},request:te,rowKey:"id",dateFormatter:"string"})})}}}]);
